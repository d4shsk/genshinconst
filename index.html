<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–æ–∑–≤–µ–∑–¥–∏—è GI</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        :root {
            --bg-color: #1a1a2e;
            --card-bg: #252540;
            --text-main: #eaeaea;
            --accent: #4ecca3;
            --cryo: #9fd6e3; --pyro: #ef7a35; --hydro: #4cc2f1;
            --electro: #b08fc2; --anemo: #74c2a8; --geo: #fab632; --dendro: #a5c83b;
            --default: #7e7e7e;
            --star-5: #ffb13b;
            --star-4: #a06fc1;
        }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-main); margin: 0; padding: 20px; }
        h1 { text-align: center; margin-bottom: 20px; }

        .controls-container { max-width: 1000px; margin: 0 auto 30px; background: #202035; padding: 20px; border-radius: 16px; display: flex; flex-direction: column; gap: 15px; }
        
        .top-row { display: flex; gap: 15px; flex-wrap: wrap; }
        .search-box { flex-grow: 1; }
        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: #2d2d48; color: white; font-size: 16px; }
        
        .filter-row { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
        .filter-btn { background: #2d2d48; border: 2px solid transparent; color: #ccc; padding: 6px 14px; border-radius: 20px; cursor: pointer; transition: 0.3s; }
        .filter-btn:hover { background: #353555; }
        .filter-btn.active { background: #444; color: white; border-color: var(--accent); }
        
        .filter-btn[data-el="pyro"].active { border-color: var(--pyro); color: var(--pyro); }
        .filter-btn[data-el="hydro"].active { border-color: var(--hydro); color: var(--hydro); }
        .filter-btn[data-star="5"].active { border-color: var(--star-5); color: var(--star-5); }
        .filter-btn[data-star="4"].active { border-color: var(--star-4); color: var(--star-4); }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 20px; max-width: 1200px; margin: 0 auto; }
        
        .card { background: var(--card-bg); border-radius: 12px; padding: 15px; cursor: pointer; transition: transform 0.2s; border-top: 4px solid var(--default); position: relative; overflow: hidden; }
        .card:hover { transform: translateY(-5px); background: #2a2a46; }
        
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .card-name { font-weight: bold; font-size: 1.1rem; }
        
        .rarity-stars { font-size: 0.8rem; letter-spacing: 2px; }
        .star-5 { color: var(--star-5); }
        .star-4 { color: var(--star-4); }

        .dmg-preview {
            background: rgba(0,0,0,0.3); padding: 8px; border-radius: 6px; 
            font-size: 0.85rem; margin-top: 10px; color: #ddd;
            display: flex; flex-direction: column; gap: 4px;
        }
        .dmg-row { display: flex; justify-content: space-between; }
        .dmg-val { color: var(--accent); font-weight: bold; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal { background: #2b2b3d; width: 90%; max-width: 800px; max-height: 90vh; border-radius: 16px; padding: 30px; overflow-y: auto; border: 1px solid #555; }
        
        .const-row { background: #232332; margin-bottom: 15px; padding: 15px; border-radius: 8px; border-left: 4px solid #555; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #1a1a26; padding: 10px; border-radius: 6px; margin-bottom: 10px; font-size: 0.9rem; }
        .stat-val { color: #fff; font-weight: bold; }
        
        .calc-dmg { 
            display: block; 
            font-size: 0.85em; 
            color: #888; 
            margin-top: 2px; 
            font-style: italic;
        }

        .cryo { border-color: var(--cryo); } .pyro { border-color: var(--pyro); } .hydro { border-color: var(--hydro); }
        .electro { border-color: var(--electro); } .anemo { border-color: var(--anemo); } .geo { border-color: var(--geo); } .dendro { border-color: var(--dendro); }
    </style>
</head>
<body>

    <h1>‚ú® –°–æ–∑–≤–µ–∑–¥–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã Arataki Ozi)</h1>

    <div class="controls-container">
        <div class="top-row">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞...">
            </div>
            <div class="sort-box">
                <select id="sortSelect">
                    <option value="element">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –ü–æ —Å—Ç–∏—Ö–∏–∏</option>
                    <option value="name">–ü–æ –∏–º–µ–Ω–∏</option>
                    <option value="–°1">–ü–æ —Å–∏–ª–µ C1</option>
                    <option value="–°2">–ü–æ —Å–∏–ª–µ C2</option>
                    <option value="–°3">–ü–æ —Å–∏–ª–µ C3</option>
                    <option value="–°4">–ü–æ —Å–∏–ª–µ C4</option>
                    <option value="–°5">–ü–æ —Å–∏–ª–µ C5</option>
                    <option value="–°6">–ü–æ —Å–∏–ª–µ C6</option>
                </select>
            </div>
        </div>

        <div class="filter-row">
            <button class="filter-btn active" data-type="el" data-val="all">–í—Å–µ</button>
            <button class="filter-btn" data-type="el" data-val="pyro">üî• –ü–∏—Ä–æ</button>
            <button class="filter-btn" data-type="el" data-val="hydro">üíß –ì–∏–¥—Ä–æ</button>
            <button class="filter-btn" data-type="el" data-val="cryo">‚ùÑÔ∏è –ö—Ä–∏–æ</button>
            <button class="filter-btn" data-type="el" data-val="electro">‚ö° –≠–ª–µ–∫—Ç—Ä–æ</button>
            <button class="filter-btn" data-type="el" data-val="anemo">üí® –ê–Ω–µ–º–æ</button>
            <button class="filter-btn" data-type="el" data-val="dendro">‚òòÔ∏è –î–µ–Ω–¥—Ä–æ</button>
            <button class="filter-btn" data-type="el" data-val="geo">üíé –ì–µ–æ</button>
        </div>
        <div class="filter-row" style="border-top: 1px solid #444; padding-top: 10px;">
            <button class="filter-btn active" data-type="rarity" data-val="all">–õ—é–±–∞—è —Ä–µ–¥–∫–æ—Å—Ç—å</button>
            <button class="filter-btn" data-type="rarity" data-val="5">‚≠êÔ∏è 5 –ó–≤–µ–∑–¥</button>
            <button class="filter-btn" data-type="rarity" data-val="4">‚≠êÔ∏è 4 –ó–≤–µ–∑–¥—ã</button>
        </div>
    </div>

    <div class="grid" id="charGrid"></div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header">
                <h2 id="modalTitle" style="margin:0; color:white;">–ò–º—è</h2>
                <button onclick="document.getElementById('modalOverlay').style.display='none'" style="background:none;border:none;color:#aaa;font-size:28px;cursor:pointer">√ó</button>
            </div>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let allCharacters = [];
        let filterEl = 'all';
        let filterRarity = 'all';
        let currentSort = 'element';

        const elementMap = { '‚ùÑÔ∏è':'cryo', '‚ùÑ':'cryo', 'üî•':'pyro', 'üíß':'hydro', '‚ö°Ô∏è':'electro', '‚ö°':'electro', 'üí®':'anemo', 'üíé':'geo', '‚òòÔ∏è':'dendro', '‚òò':'dendro' };
        const elementPriority = ['pyro', 'hydro', 'anemo', 'electro', 'dendro', 'cryo', 'geo', 'default'];

        async function loadData() {
            try {
                const response = await fetch('result.json');
                allCharacters = await response.json();
                applyFilters();
            } catch (e) {
                document.getElementById('charGrid').innerHTML = "<p style='text-align:center'>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ result.json</p>";
            }
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = allCharacters.filter(char => {
                const elKey = elementMap[char.element] || 'default';
                const matchEl = (filterEl === 'all') || (elKey === filterEl);
                const matchRarity = (filterRarity === 'all') || (char.rarity === filterRarity);
                const matchName = char.name.toLowerCase().includes(search);
                return matchEl && matchRarity && matchName;
            });

            filtered.sort((a, b) => {
                if (currentSort === 'element') {
                    const elA = elementMap[a.element] || 'default';
                    const elB = elementMap[b.element] || 'default';
                    const idxA = elementPriority.indexOf(elA);
                    const idxB = elementPriority.indexOf(elB);
                    if (idxA !== idxB) return idxA - idxB;
                    return a.name.localeCompare(b.name);
                }
                if (currentSort === 'name') return a.name.localeCompare(b.name);
                
                const valA = parsePercent(a.constellations[currentSort]?.damage);
                const valB = parsePercent(b.constellations[currentSort]?.damage);
                return valB - valA;
            });

            renderGrid(filtered);
        }

        function parsePercent(str) {
            if (!str || str === '-') return -1;
            const matches = str.replace(',', '.').match(/(\d+\.\d+|\d+)/g);
            if (!matches) return -1;
            return Math.max(...matches.map(n => parseFloat(n)));
        }

        function renderGrid(chars) {
            const grid = document.getElementById('charGrid');
            grid.innerHTML = '';

            if (chars.length === 0) { grid.innerHTML = '<p style="text-align:center;grid-column:1/-1">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>'; return; }

            chars.forEach(char => {
                const elClass = elementMap[char.element] || '';
                const rarityStars = char.rarity === "5" ? "‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê" : "‚≠ê‚≠ê‚≠ê‚≠ê";
                const rarityClass = char.rarity === "5" ? "star-5" : "star-4";

                let previewHtml = '';
                
                // --- –õ–û–ì–ò–ö–ê –û–¢–û–ë–†–ê–ñ–ï–ù–ò–Ø (–¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –í–°–Å, —á—Ç–æ > 0) ---
                if (char.base_stats) {
                    const f = char.base_stats.field || 0;
                    const f_max = char.base_stats.field_max || 0;
                    const o = char.base_stats.off_field || 0;
                    const o_max = char.base_stats.off_field_max || 0;

                    let rows = '';
                    
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —É—Ä–æ–Ω –Ω–∞ –ø–æ–ª–µ
                    if (f > 0 || f_max > 0) {
                        rows += `<div class="dmg-row"><span>–ü–æ–ª–µ:</span> <span style="color:#fff">${f} / ${f_max}–∫</span></div>`;
                    }
                    // –ï—Å–ª–∏ –µ—Å—Ç—å —É—Ä–æ–Ω —Å –∫–∞—Ä–º–∞–Ω–∞
                    if (o > 0 || o_max > 0) {
                        rows += `<div class="dmg-row"><span>–ö–∞—Ä–º–∞–Ω:</span> <span style="color:#fff">${o} / ${o_max}–∫</span></div>`;
                    }

                    // –ï—Å–ª–∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–Ω—Å—Ç–µ, –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ —Å—Ç—Ä–æ–∫—É —Å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º
                    if (currentSort.startsWith('–°')) {
                        const cData = char.constellations[currentSort];
                        const dmgVal = cData?.damage || '-';
                        rows = `<div class="dmg-row" style="border-bottom:1px solid #555; padding-bottom:4px; margin-bottom:4px;">
                                    <span>${currentSort}:</span> <span class="dmg-val">${dmgVal}</span>
                                </div>` + rows;
                    }

                    if (rows) {
                        previewHtml = `<div class="dmg-preview">${rows}</div>`;
                    }
                }

                const card = document.createElement('div');
                card.className = `card ${elClass}`;
                card.onclick = () => showDetails(char);
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-name">${char.name}</div>
                        <div class="card-elem">${char.element}</div>
                    </div>
                    <div class="rarity-stars ${rarityClass}">${rarityStars}</div>
                    ${previewHtml}
                `;
                grid.appendChild(card);
            });
        }

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const type = btn.dataset.type;
                const val = btn.dataset.val;
                document.querySelectorAll(`.filter-btn[data-type="${type}"]`).forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                if (type === 'el') filterEl = val;
                if (type === 'rarity') filterRarity = val;
                applyFilters();
            });
        });

        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('sortSelect').addEventListener('change', (e) => {
            currentSort = e.target.value;
            applyFilters();
        });

        function showDetails(char) {
            const modal = document.getElementById('modalOverlay');
            const elKey = elementMap[char.element] || 'default';
            const elColor = getComputedStyle(document.documentElement).getPropertyValue(`--${elKey}`);
            
            document.getElementById('modalTitle').innerHTML = `${char.name} <span style="color:${elColor}">${char.element}</span>`;
            
            let html = '';
            if (char.base_stats) {
                const s = char.base_stats;
                if ((s.field > 0 || s.field_max > 0) || (s.off_field > 0 || s.off_field_max > 0)) {
                    html += `<div style="background:#20202a; padding:12px; margin-bottom:15px; border-radius:8px; font-size:0.9em; display:grid; grid-template-columns: 1fr 1fr; gap:10px; color:#ccc;">
                        <div style="border-bottom:1px solid #444; padding-bottom:5px;">–ü–æ–ª–µ: <b style="color:#fff">${s.field||0} / ${s.field_max||0}–∫</b></div>
                        <div style="border-bottom:1px solid #444; padding-bottom:5px;">–ö–∞—Ä–º–∞–Ω: <b style="color:#fff">${s.off_field||0} / ${s.off_field_max||0}–∫</b></div>
                    </div>`;
                }
            }

            Object.keys(char.constellations).sort().forEach(key => {
                const c = char.constellations[key];
                const activeStyle = (key === currentSort) ? `border:1px solid var(--accent); background:rgba(78,204,163,0.05);` : '';
                
                // –†–ê–°–ß–ï–¢ –£–†–û–ù–ê (–ò –¢–ê–ú, –ò –¢–ê–ú)
                let calcHtml = '';
                const pct = parsePercent(c.damage);
                if (pct > 0 && char.base_stats) {
                    const s = char.base_stats;
                    const f = s.field || 0;
                    const f_max = s.field_max || 0;
                    const o = s.off_field || 0;
                    const o_max = s.off_field_max || 0;

                    let calcLines = [];

                    // –°—á–∏—Ç–∞–µ–º –¥–ª—è –ü–û–õ–Ø
                    if (f > 0 || f_max > 0) {
                        const add1 = (f * pct / 100).toFixed(1);
                        const add2 = (f_max * pct / 100).toFixed(1);
                        calcLines.push(`‚âà +${add1} / +${add2}–∫ (–ü–æ–ª–µ)`);
                    }
                    // –°—á–∏—Ç–∞–µ–º –¥–ª—è –ö–ê–†–ú–ê–ù–ê
                    if (o > 0 || o_max > 0) {
                        const add1 = (o * pct / 100).toFixed(1);
                        const add2 = (o_max * pct / 100).toFixed(1);
                        calcLines.push(`‚âà +${add1} / +${add2}–∫ (–ö–∞—Ä–º–∞–Ω)`);
                    }

                    if (calcLines.length > 0) {
                        calcHtml = calcLines.map(line => `<span class="calc-dmg">${line}</span>`).join('');
                    }
                }

                let energyHtml = c.energy ? `<div style="color:#d48df0; margin-top:5px; font-weight:bold;">‚ö° ${c.energy}</div>` : '';
                let noteHtml = c.note ? `<div style="margin-top:8px;padding:8px;background:rgba(255,200,0,0.1);border-radius:4px;color:#ffdb78;font-size:0.85em;">üí° ${c.note}</div>` : '';

                html += `
                    <div class="const-row" style="border-left-color: ${elColor}; ${activeStyle}">
                        <div style="color:var(--accent); font-weight:bold; margin-bottom:5px;">${key}</div>
                        <div class="stats-grid">
                            <div><span style="color:#aaa">–£—Ä–æ–Ω:</span> <span class="stat-val">${c.damage}</span> ${calcHtml}</div>
                            <div><span style="color:#aaa">–°–∞–ø–ø–æ—Ä—Ç:</span> <span class="stat-val">${c.support}</span></div>
                        </div>
                        <div style="line-height:1.4; color:#ddd;">${c.description}</div>
                        ${energyHtml}
                        ${noteHtml}
                    </div>
                `;
            });

            document.getElementById('modalContent').innerHTML = html;
            modal.style.display = 'flex';
        }

        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modalOverlay')) {
                document.getElementById('modalOverlay').style.display='none';
            }
        });

        loadData();
    </script>
</body>
</html>